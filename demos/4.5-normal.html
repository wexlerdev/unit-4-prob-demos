<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>4.5 Normal Distribution</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
  <header>
    <h1>Unit 4: Probability and Statistical Inference</h1>
    <p class="subtitle">4.5 — Normal Distribution and Probabilities</p>
  </header>

  <main class="demo-page">
    <a href="../index.html" class="back-link">← Back to all sections</a>

    <h1>4.5: Normal Distribution</h1>

    <div class="concept-block">
      <h2>What You'll Learn</h2>
      <ul>
        <li>Use the normal curve for probabilities and percentiles</li>
        <li>Transform with z-scores: \(z = (x - \mu)/\sigma\)</li>
        <li>Apply the 68–95–99.7 rule (μ±σ, μ±2σ, μ±3σ)</li>
      </ul>
      <p><strong>When to use:</strong> Many measurements (scores, heights, weights) are approximately normal. Also underpins inference: sample means and proportions become normal via CLT.</p>
      <p><strong>Prerequisites:</strong> <a href="4.3-discrete-rv.html">4.3</a> — mean and standard deviation.</p>
    </div>

    <div class="content-section">
      <h2>Overview</h2>
      <p>Bell-shaped, symmetric about \(\mu\). Described by mean \(\mu\) and standard deviation \(\sigma\). Probabilities = area under the curve. Use CDF \(P(X \leq x)\).</p>
    </div>

    <div class="content-section">
      <h2>Z-Score &amp; Standard Normal</h2>
      <p>Transform to standard normal: \(z = (x - \mu)/\sigma\). Inverse: \(x = \mu + z\sigma\) for percentiles.</p>
    </div>

    <div class="content-section">
      <h2>Management Exam Example</h2>
      <p><strong>Story:</strong> Management aptitude scores are normally distributed with \(\mu=72\), \(\sigma=8\). \(P(X>60)=0.9332\), \(P(68 \leq X \leq 84)=0.6247\). 90th percentile ≈ 82.25 (lowest score in top 10%).</p>
    </div>

    <h2>Interactive Demo</h2>
    <div class="demo-box">
      <h3>Normal Curve — Probabilities</h3>
      <div class="input-row">
        <div class="input-group">
          <label>\(\mu\)</label>
          <input type="number" id="mu" value="72">
        </div>
        <div class="input-group">
          <label>\(\sigma\)</label>
          <input type="number" id="sig" value="8" min="0.1">
        </div>
        <div class="input-group">
          <label>\(a\) (lower bound)</label>
          <input type="number" id="a" value="68">
        </div>
        <div class="input-group">
          <label>\(b\) (upper bound)</label>
          <input type="number" id="b" value="84">
        </div>
      </div>
      <div class="result">\(P(a \leq X \leq b)\) = <span id="prob" class="value">0.6247</span></div>
    </div>

    <div class="demo-box">
      <h3>68–95–99.7 Rule</h3>
      <p>About 68% of values fall within \(\mu \pm \sigma\), 95% within \(\mu \pm 2\sigma\), and 99.7% within \(\mu \pm 3\sigma\). Adjust \(\mu\) and \(\sigma\) to see how the bands scale.</p>
      <div class="input-row">
        <div class="input-group">
          <label>\(\mu\)</label>
          <input type="number" id="muRule" value="72">
        </div>
        <div class="input-group">
          <label>\(\sigma\)</label>
          <input type="number" id="sigRule" value="8" min="0.1">
        </div>
      </div>
      <div class="result">
        \(P(\mu - \sigma \leq X \leq \mu + \sigma)\) ≈ <span id="p68" class="value">0.683</span> (68%)<br>
        \(P(\mu - 2\sigma \leq X \leq \mu + 2\sigma)\) ≈ <span id="p95" class="value">0.954</span> (95%)<br>
        \(P(\mu - 3\sigma \leq X \leq \mu + 3\sigma)\) ≈ <span id="p997" class="value">0.997</span> (99.7%)
      </div>
      <canvas id="ruleChart" width="600" height="220"></canvas>
    </div>

    <div class="demo-box">
      <h3>Z-Score &amp; Percentile</h3>
      <div class="input-row">
        <div class="input-group">
          <label>\(x\) (for z-score and \(P(X \leq x)\))</label>
          <input type="number" id="xVal" value="60">
        </div>
        <div class="input-group">
          <label>Percentile (e.g. 90 → find \(x\) where \(P(X<x)=0.9\))</label>
          <input type="number" id="pct" value="90" min="1" max="99">
        </div>
      </div>
      <div class="result">
        \(z = (x-\mu)/\sigma\) = <span id="zVal">-1.5</span><br>
        \(P(X \leq x)\) = <span id="cdfVal">0.0668</span><br>
        <span id="pctLabel">90th percentile \(x\)</span> ≈ <span id="xPct">82.24</span>
      </div>
    </div>
    <div class="demo-box">
      <canvas id="normChart" width="600" height="280"></canvas>
    </div>
  </main>

  <footer><a href="../index.html">← Back to all sections</a></footer>

  <script src="../js/shared.js"></script>
  <script src="../js/flare.js"></script>
  <script>
    function simpleZForPct(p) {
      const tbl = [[50,0],[60,0.253],[70,0.524],[80,0.842],[90,1.282],[95,1.645],[97.5,1.96],[99,2.326]];
      if (p <= 50) return -simpleZForPct(100 - p);
      for (let i = tbl.length - 2; i >= 0; i--) if (p >= tbl[i][0]) return tbl[i][1] + (tbl[i+1][1]-tbl[i][1]) * (p - tbl[i][0]) / (tbl[i+1][0] - tbl[i][0]);
      return 2.576;
    }

    function parseVal(id, def) { const v = parseFloat(document.getElementById(id)?.value); return isNaN(v) ? def : v; }

    function updateNormal() {
      const mu = parseVal('mu',72), sig = parseVal('sig',8);
      const a = parseVal('a',68), b = parseVal('b',84);
      const za = (a - mu) / sig, zb = (b - mu) / sig;
      const prob = normCDF(zb) - normCDF(za);
      document.getElementById('prob').textContent = prob.toFixed(4);

      const xVal = parseVal('xVal',60);
      const z = (xVal - mu) / sig;
      const cdf = normCDF(z);
      document.getElementById('zVal').textContent = z.toFixed(2);
      document.getElementById('cdfVal').textContent = cdf.toFixed(4);

      const pct = parseVal('pct',90);
      const zPct = simpleZForPct(pct);
      const xPct = mu + zPct * sig;
      document.getElementById('xPct').textContent = xPct.toFixed(2);
      document.getElementById('pctLabel').textContent = pct + 'th percentile \\(x\\)';

      if (window.normChart) {
        const xs = [], ys = [];
        for (let i = mu - 4*sig; i <= mu + 4*sig; i += sig/5) {
          xs.push(i.toFixed(1));
          ys.push(Math.exp(-0.5*Math.pow((i-mu)/sig,2)) / (sig*Math.sqrt(2*Math.PI)));
        }
        window.normChart.data.datasets[0].data = ys;
        window.normChart.data.labels = xs;
        window.normChart.update();
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      const xs = [], ys = [];
      const mu = 72, sig = 8;
      for (let i = mu - 4*sig; i <= mu + 4*sig; i += sig/5) {
        xs.push(i.toFixed(1));
        ys.push(Math.exp(-0.5*Math.pow((i-mu)/sig,2)) / (sig*Math.sqrt(2*Math.PI)));
      }
      window.normChart = new Chart(document.getElementById('normChart').getContext('2d'), {
        type: 'line',
        data: { labels: xs, datasets: [{ label: 'N(μ,σ²)', data: ys, fill: true, tension: 0.3, backgroundColor: 'rgba(122,162,247,0.1)', borderColor: 'rgb(122,162,247)' }] },
        options: { responsive: true, scales: { y: { beginAtZero: true } }, plugins: { legend: { display: false } } }
      });
      updateNormal();
    });
    function normPdf(x, mu, sig) {
      return Math.exp(-0.5 * Math.pow((x - mu) / sig, 2)) / (sig * Math.sqrt(2 * Math.PI));
    }

    function drawRuleChart() {
      const mu = parseVal('muRule', 72), sig = parseVal('sigRule', 8);
      const p68 = normCDF(1) - normCDF(-1);
      const p95 = normCDF(2) - normCDF(-2);
      const p997 = normCDF(3) - normCDF(-3);
      document.getElementById('p68').textContent = p68.toFixed(3);
      document.getElementById('p95').textContent = p95.toFixed(3);
      document.getElementById('p997').textContent = p997.toFixed(3);

      const canvas = document.getElementById('ruleChart');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      const w = canvas.width, h = canvas.height;
      const pad = { l: 50, r: 30, t: 20, b: 40 };
      const xMin = mu - 4 * sig, xMax = mu + 4 * sig;
      const plotW = w - pad.l - pad.r, plotH = h - pad.t - pad.b;

      ctx.fillStyle = '#1a1b26';
      ctx.fillRect(0, 0, w, h);

      const x2px = x => pad.l + ((x - xMin) / (xMax - xMin)) * plotW;
      const y2py = y => pad.t + plotH - (y / (normPdf(mu, mu, sig) * 1.05)) * plotH;

      // Draw shaded bands (outer to inner)
      const bands = [
        { lo: mu - 3*sig, hi: mu + 3*sig, color: 'rgba(122,162,247,0.15)' },
        { lo: mu - 2*sig, hi: mu + 2*sig, color: 'rgba(122,162,247,0.25)' },
        { lo: mu - sig, hi: mu + sig, color: 'rgba(122,162,247,0.4)' }
      ];
      bands.forEach(b => {
        ctx.beginPath();
        for (let x = b.lo; x <= b.hi; x += sig/20) {
          const px = x2px(x), py = y2py(normPdf(x, mu, sig));
          ctx.lineTo(px, py);
        }
        ctx.lineTo(x2px(b.hi), pad.t + plotH);
        ctx.lineTo(x2px(b.lo), pad.t + plotH);
        ctx.closePath();
        ctx.fillStyle = b.color;
        ctx.fill();
      });

      // Draw curve
      ctx.beginPath();
      ctx.strokeStyle = 'rgb(122,162,247)';
      ctx.lineWidth = 2;
      for (let x = xMin; x <= xMax; x += sig/15) {
        ctx.lineTo(x2px(x), y2py(normPdf(x, mu, sig)));
      }
      ctx.stroke();

      // Axis
      ctx.strokeStyle = 'rgba(255,255,255,0.3)';
      ctx.beginPath();
      ctx.moveTo(pad.l, pad.t); ctx.lineTo(pad.l, h - pad.b); ctx.lineTo(w - pad.r, h - pad.b);
      ctx.stroke();
      ctx.fillStyle = '#a9b1d6';
      ctx.font = '11px sans-serif';
      ctx.fillText('x', w - pad.r - 15, h - 5);
      [-2, -1, 0, 1, 2].forEach(z => {
        const x = mu + z * sig;
        ctx.fillText(z ? `μ${z>0?'+':''}${z}σ` : 'μ', x2px(x) - 15, h - 8);
      });
    }

    document.addEventListener('DOMContentLoaded', function() {
      const xs = [], ys = [];
      const mu = 72, sig = 8;
      for (let i = mu - 4*sig; i <= mu + 4*sig; i += sig/5) {
        xs.push(i.toFixed(1));
        ys.push(Math.exp(-0.5*Math.pow((i-mu)/sig,2)) / (sig*Math.sqrt(2*Math.PI)));
      }
      window.normChart = new Chart(document.getElementById('normChart').getContext('2d'), {
        type: 'line',
        data: { labels: xs, datasets: [{ label: 'N(μ,σ²)', data: ys, fill: true, tension: 0.3, backgroundColor: 'rgba(122,162,247,0.1)', borderColor: 'rgb(122,162,247)' }] },
        options: { responsive: true, scales: { y: { beginAtZero: true } }, plugins: { legend: { display: false } } }
      });
      updateNormal();
      drawRuleChart();
    });
    ['mu','sig','a','b','xVal','pct'].forEach(id => document.getElementById(id).addEventListener('input', updateNormal));
    ['muRule','sigRule'].forEach(id => document.getElementById(id).addEventListener('input', () => {
      drawRuleChart();
      if (typeof showFlare === 'function') {
        showFlare('ZING', document.getElementById('ruleChart'), { size: 'small', key: 'rule' });
      }
    }));
  </script>
</body>
</html>
