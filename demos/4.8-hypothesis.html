<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>4.8 Hypothesis Testing</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
</head>
<body>
  <header>
    <h1>Unit 4: Probability and Statistical Inference</h1>
    <p class="subtitle">4.8 — Hypothesis Testing</p>
  </header>

  <main class="demo-page">
    <a href="../index.html" class="back-link">← Back to all sections</a>

    <h1>4.8: Hypothesis Testing</h1>

    <div class="concept-block">
      <h2>What You'll Learn</h2>
      <ul>
        <li>Formulate null \(H_0\) and alternative \(H_A\) hypotheses</li>
        <li>Use p-values and rejection regions to decide reject vs. do not reject</li>
        <li>Understand Type I (false positive) and Type II (false negative) errors</li>
      </ul>
      <p><strong>When to use:</strong> You want to test a claim about a population (e.g., "Does our cereal meet the 1 lb target?"). Sample evidence either supports or contradicts the null.</p>
      <p><strong>Prerequisites:</strong> <a href="4.7-confidence.html">4.7</a> — confidence intervals, standard error.</p>
    </div>

    <div class="content-section">
      <h2>What Is Hypothesis Testing?</h2>
      <p>We compare two competing hypotheses about a population. We test the <strong>null</strong> against the <strong>alternative</strong> using sample evidence.</p>
    </div>

    <div class="content-section">
      <h2>Null and Alternative Hypotheses</h2>
      <ul>
        <li><strong>\(H_0\) (null):</strong> Status quo; uses \(=\), \(\leq\), or \(\geq\).</li>
        <li><strong>\(H_A\) (alternative):</strong> Claim we want to evaluate; uses \(\neq\), \(>\), or \(<\).</li>
      </ul>
      <p><strong>Reject</strong> \(H_0\) when evidence is inconsistent with it. <strong>Do not reject</strong> when evidence doesn't contradict it. We never "accept" \(H_0\) — failing to reject is not proof it's true.</p>
    </div>

    <div class="content-section">
      <h2>One-Tailed vs Two-Tailed</h2>
      <p><strong>One-tailed:</strong> \(H_A\) uses \(<\) or \(>\). <strong>Two-tailed:</strong> \(H_A\) uses \(\neq\).</p>
    </div>

    <div class="content-section">
      <h2>Decision Errors</h2>
      <table class="demo-table">
        <thead>
          <tr>
            <th></th>
            <th>\(H_0\) true</th>
            <th>\(H_0\) false</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Reject \(H_0\)</strong></td>
            <td class="error-cell">Type I error</td>
            <td class="highlight">Correct</td>
          </tr>
          <tr>
            <td><strong>Do not reject \(H_0\)</strong></td>
            <td class="highlight">Correct</td>
            <td class="error-cell">Type II error</td>
          </tr>
        </tbody>
      </table>
      <p><strong>Type I:</strong> Reject \(H_0\) when it's true (false positive). <strong>Type II:</strong> Fail to reject \(H_0\) when it's false (false negative).</p>
    </div>

    <h2>Interactive Demo: Hypothesis Test (z-Test for Mean)</h2>
    <div class="demo-box">
      <h3>Full Test: Cereal Box Weight</h3>
      <p><strong>Scenario:</strong> Cereal boxes should average 1 lb. Sample of 25 has \(\bar{x}=1.02\), \(\sigma=0.03\). Test \(H_0: \mu=1\) vs \(H_A: \mu \neq 1\).</p>
      <div class="input-row">
        <div class="input-group">
          <label>\(\bar{x}\)</label>
          <input type="number" id="htXbar" value="1.02" step="0.01">
        </div>
        <div class="input-group">
          <label>\(\mu_0\) (under \(H_0\))</label>
          <input type="number" id="htMu0" value="1" step="0.01">
        </div>
        <div class="input-group">
          <label>\(\sigma\)</label>
          <input type="number" id="htSigma" value="0.03" min="0.001" step="0.001">
        </div>
        <div class="input-group">
          <label>\(n\)</label>
          <input type="number" id="htN" value="25" min="2">
        </div>
        <div class="input-group">
          <label>\(\alpha\)</label>
          <select id="htAlpha">
            <option value="0.10">0.10</option>
            <option value="0.05" selected>0.05</option>
            <option value="0.01">0.01</option>
          </select>
        </div>
      </div>
      <div class="result">
        \(z = \frac{\bar{x}-\mu_0}{\sigma/\sqrt{n}}\) = <span id="htZ" class="value">3.33</span><br>
        p-value (two-tailed) = <span id="htPval" class="value">0.0009</span><br>
        <strong id="htDecision">Reject \(H_0\)</strong> at \(\alpha=0.05\) — evidence that mean differs from 1 lb.
      </div>
      <canvas id="rejectChart" width="500" height="180"></canvas>
      <p style="font-size:0.85rem; color: var(--text-dim); margin-top:0.5rem;">Rejection region (shaded): |z| &gt; \(z_{\alpha/2}\)</p>
    </div>

    <h2>Interactive Demo: Hypothesis Builder</h2>
    <div class="demo-box">
      <p>Generate \(H_0\) and \(H_A\) for common scenarios.</p>
      <div class="input-row">
        <div class="input-group">
          <label>Parameter</label>
          <select id="param">
            <option value="μ">μ (mean)</option>
            <option value="p">p (proportion)</option>
          </select>
        </div>
        <div class="input-group">
          <label> hypothesized value</label>
          <input type="number" id="val" value="100" step="0.1">
        </div>
        <div class="input-group">
          <label>Test type</label>
          <select id="tail">
            <option value="two">Two-tailed (≠)</option>
            <option value="upper">Upper (>)</option>
            <option value="lower">Lower (<)</option>
          </select>
        </div>
      </div>
      <div class="result">
        \(H_0\): <span id="h0">\(\mu = 100\)</span><br>
        \(H_A\): <span id="ha">\(\mu \neq 100\)</span>
      </div>
    </div>

    <div class="demo-box">
      <h3>Decision Table — Hover for Explanation</h3>
      <table class="demo-table">
        <thead>
          <tr><th></th><th>\(H_0\) true</th><th>\(H_0\) false</th></tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Reject \(H_0\)</strong></td>
            <td class="error-cell" title="Type I: Incorrectly conclude there is an effect">Type I error</td>
            <td class="highlight" title="Correct: Detect a real effect">Correct</td>
          </tr>
          <tr>
            <td><strong>Do not reject \(H_0\)</strong></td>
            <td class="highlight" title="Correct: No effect, we don't find one">Correct</td>
            <td class="error-cell" title="Type II: Miss a real effect">Type II error</td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>

  <footer><a href="../index.html">← Back to all sections</a></footer>

  <script src="../js/shared.js"></script>
  <script src="../js/flare.js"></script>
  <script>
    function updateHyp() {
      const param = document.getElementById('param').value || 'μ';
      const latexParam = (param === 'μ' || param === 'mu') ? '\\mu' : (param === 'p' ? 'p' : param);
      const val = document.getElementById('val').value;
      const tail = document.getElementById('tail').value;
      let h0, ha;
      if (tail === 'two') { h0 = latexParam + ' = ' + val; ha = latexParam + ' \\neq ' + val; }
      else if (tail === 'upper') { h0 = latexParam + ' \\leq ' + val; ha = latexParam + ' > ' + val; }
      else { h0 = latexParam + ' \\geq ' + val; ha = latexParam + ' < ' + val; }
      const h0El = document.getElementById('h0'), haEl = document.getElementById('ha');
      h0El.innerHTML = '\\( ' + h0 + ' \\)';
      haEl.innerHTML = '\\( ' + ha + ' \\)';
      if (typeof renderMathInElement === 'function') {
        renderMathInElement(document.getElementById('h0').closest('.result'), { delimiters: [{ left: '\\(', right: '\\)', display: false }], throwOnError: false });
      }
    }
    function parseVal(id, def) { const v = parseFloat(document.getElementById(id)?.value); return isNaN(v) ? def : v; }
    const zVals = { 0.10: 1.645, 0.05: 1.96, 0.01: 2.576 };

    function updateHT() {
      const xbar = parseVal('htXbar', 1.02), mu0 = parseVal('htMu0', 1), sigma = parseVal('htSigma', 0.03), n = parseVal('htN', 25);
      const alpha = parseFloat(document.getElementById('htAlpha')?.value || 0.05);
      const se = sigma / Math.sqrt(n);
      const z = (xbar - mu0) / se;
      const pVal = 2 * (1 - normCDF(Math.abs(z)));
      const zCrit = zVals[alpha] ?? 1.96;
      const reject = pVal < alpha;

      document.getElementById('htZ').textContent = z.toFixed(2);
      document.getElementById('htPval').textContent = pVal.toFixed(4);
      const dec = document.getElementById('htDecision');
      dec.innerHTML = reject
        ? 'Reject \\(H_0\\) at \\(\\alpha=' + alpha + '\\) — evidence that mean differs from ' + mu0 + '.'
        : 'Do not reject \\(H_0\\) — evidence does not contradict \\(\\mu=' + mu0 + '\\)';

      if (reject && typeof showFlare === 'function') {
        showFlare('BAM', dec, { size: 'big', key: 'ht' });
      }
      drawRejectChart(z, zCrit, alpha);
      if (typeof renderMathInElement === 'function') renderMathInElement(document.body, { delimiters: [{ left: '\\(', right: '\\)', display: false }], throwOnError: false });
    }

    function drawRejectChart(z, zCrit, alpha) {
      const canvas = document.getElementById('rejectChart');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      const w = canvas.width, h = canvas.height;
      const pad = { l: 50, r: 40, t: 25, b: 45 };
      const plotW = w - pad.l - pad.r, plotH = h - pad.t - pad.b;
      const xMin = -4, xMax = 4;

      ctx.fillStyle = '#1e1b2e';
      ctx.fillRect(0, 0, w, h);

      const x2px = xx => pad.l + ((xx - xMin) / (xMax - xMin)) * plotW;
      const normPdf = x => Math.exp(-0.5 * x * x) / Math.sqrt(2 * Math.PI);
      const maxY = normPdf(0);
      const y2py = y => pad.t + plotH - (y / maxY) * plotH;

      // Shade rejection regions (tails)
      ctx.fillStyle = 'rgba(247, 118, 142, 0.4)';
      ctx.beginPath();
      for (let x = xMin; x <= -zCrit; x += 0.05) ctx.lineTo(x2px(x), y2py(normPdf(x)));
      ctx.lineTo(x2px(-zCrit), pad.t + plotH);
      ctx.lineTo(x2px(xMin), pad.t + plotH);
      ctx.closePath();
      ctx.fill();
      ctx.beginPath();
      for (let x = zCrit; x <= xMax; x += 0.05) ctx.lineTo(x2px(x), y2py(normPdf(x)));
      ctx.lineTo(x2px(xMax), pad.t + plotH);
      ctx.lineTo(x2px(zCrit), pad.t + plotH);
      ctx.closePath();
      ctx.fill();

      // Draw curve
      ctx.beginPath();
      ctx.strokeStyle = '#c4b5fd';
      ctx.lineWidth = 2;
      for (let x = xMin; x <= xMax; x += 0.08) ctx.lineTo(x2px(x), y2py(normPdf(x)));
      ctx.stroke();

      // Mark z and critical values
      ctx.strokeStyle = '#f7768e';
      ctx.setLineDash([3, 3]);
      ctx.beginPath();
      ctx.moveTo(x2px(zCrit), pad.t); ctx.lineTo(x2px(zCrit), h - pad.b);
      ctx.moveTo(x2px(-zCrit), pad.t); ctx.lineTo(x2px(-zCrit), h - pad.b);
      ctx.stroke();
      ctx.setLineDash([]);
      if (Math.abs(z) <= 4) {
        ctx.strokeStyle = '#9ece6a';
        ctx.beginPath();
        ctx.moveTo(x2px(z), pad.t); ctx.lineTo(x2px(z), h - pad.b);
        ctx.stroke();
      }

      ctx.fillStyle = '#b8add9';
      ctx.font = '11px sans-serif';
      ctx.fillText('-z', x2px(-zCrit) - 18, h - 8);
      ctx.fillText('z', x2px(zCrit) - 8, h - 8);
      ctx.fillText('z=' + z.toFixed(1), x2px(z) + 5, pad.t + 15);
      ctx.strokeStyle = 'rgba(255,255,255,0.3)';
      ctx.beginPath();
      ctx.moveTo(pad.l, pad.t); ctx.lineTo(pad.l, h - pad.b); ctx.lineTo(w - pad.r, h - pad.b);
      ctx.stroke();
    }

    ['htXbar','htMu0','htSigma','htN','htAlpha'].forEach(id => {
      const el = document.getElementById(id);
      if (el) { el.addEventListener('input', updateHT); el.addEventListener('change', updateHT); }
    });

    document.addEventListener('DOMContentLoaded', updateHT);

    ['param','val','tail'].forEach(id => document.getElementById(id).addEventListener('input', updateHyp));
    ['param','val','tail'].forEach(id => document.getElementById(id).addEventListener('change', updateHyp));
    updateHyp();
  </script>
</body>
</html>
